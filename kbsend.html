Ip: <input id=ip></input></br>
Port: <input id=port value=7800></input></br>
Mobile: <input autofocus id=free></input></br>

<div id=out>
</div>

<style>
kbd {
    background-color: #eee;
    border-radius: 3px;
    border: 1px solid #b4b4b4;
    color: #333;
    display: inline-block;
    padding: 2px 4px;
    margin: 0px 1px;
    white-space: nowrap;
}
</style>

<script>
var elemout = document.getElementById('out')
var elemip = document.getElementById('ip')
var elemport = document.getElementById('port')

if (localStorage.getItem('ip')) {
    elemip.value = localStorage.getItem('ip')
} else {
    elemip.value = '127.0.0.1'
}

ip.oninput = function(e) {
    localStorage.setItem('ip', elemip.value)
}

function log(x) {
    var keynode = document.createElement('kbd')
    keynode.innerText = String(x).replace(' ', '_')
    elemout.appendChild(keynode)
}

function toHex(str,hex){
  try{
      hex = unescape(encodeURIComponent(str)).split('').map(function(v){
          var r = v.charCodeAt(0).toString(16)
          if (r.length == 0) return '00'
          if (r.length == 1) return '0' + r
          return r
      }).join('')
  }
  catch(e){
      return ''
  }
  return hex
}

document.onkeydown = function (e) {
    if (e.target == elemport || e.target == elemip) {
        return;
    }
    if (e.ctrlKey) { // handle ^W
        var stopEvilCtrlW = function(e) {
            e.preventDefault();
            return "^W";
        },  clearEvilCtrlW = function() {
            window.removeEventListener('beforeunload', stopEvilCtrlW, false);
        };
        setTimeout(clearEvilCtrlW, 1000);
        window.addEventListener('beforeunload', stopEvilCtrlW, false);
    }
    key = e.key
    if (e.ctrlKey && key.length == 1) {
        var code = key.charCodeAt(0) & (0x20-1)
        key = String.fromCharCode(code)
    }
    switch (key) {
        case 'Enter':
            key = '\n';
            break;
        case 'Escape':
            key = '\x1b'
            break;
        case 'Shift':
        case 'Control':
            return;
    }
    var body = toHex(key)
    var host = elemip.value
    var port = elemport.value
    fetch('http://' + host + ':' + port + '/', {
        method: 'POST',
        body: body
    }).then(res => {
        return res.text()
    }).then(text => {
    }).catch(e => {
        log(e)
    })

    return false;
}
</script>
